-- title:  Croco Craze
-- author: StinkerB06
-- desc:   Clone of the popular Hasbro game
-- input:  keyboard
-- saveid: CrocoGameSB2K

GAME={frame=0, numTeeth=13, toothCount=0, mode=0}
-- See the TIC-80 Wiki for key codes:
-- https://github.com/nesbox/TIC-80/wiki/key
KEYcode,Tstat={17,23,5,18,20,25,21,9,15,16,39,40,41},{}

BGc=1 -- Background color






-- Fading
FADE={
	mode="OUT", brightness=1/16, nextMode=GAME.mode,
	nextMusic={1,0,0,true}
}
palRAM={R={},G={},B={}}
for color=0,15 do
	palRAM.R[color]=peek(0x3FC0+(color*3))
	palRAM.G[color]=peek(0x3FC1+(color*3))
	palRAM.B[color]=peek(0x3FC2+(color*3))
end
function Cset(color,r,g,b)
	poke(0x3FC0+(color*3),r*FADE.brightness)
	poke(0x3FC1+(color*3),g*FADE.brightness)
	poke(0x3FC2+(color*3),b*FADE.brightness)
end
function processFades()
	if FADE.mode=="OUT" then
		FADE.brightness=(FADE.brightness-1/16)
		for color=0,15 do
			if color==BGc then color=color+1 end
			local red=palRAM.R[color]
			local green=palRAM.G[color]
			local blue=palRAM.B[color]
			Cset(color,red,green,blue)
		end
		if FADE.brightness<=0 then
			if FADE.nextMusic~=nil then
				local m=FADE.nextMusic
				music(m[1],m[2],m[3]-1,m[4])
			end
			GAME.mode=FADE.nextMode
			FADE.mode="IN"
		end
		return
	elseif FADE.mode=="IN" then
		FADE.brightness=(FADE.brightness+1/16)
		for color=0,15 do
			if color==BGc then color=color+1 end
			local red=palRAM.R[color]
			local green=palRAM.G[color]
			local blue=palRAM.B[color]
			Cset(color,red,green,blue)
		end
		if FADE.brightness>=1 then FADE.mode="OFF" end
	end
end
--

for i=1,GAME.numTeeth do Tstat[i]=false end

-- This function originates from btco's "8 Bit Panda" game,
-- but modified to use an and/or statement.
-- They basically function the same way.
function Iif(cond,t,f) return cond and t or f end
--
function exception(msg) trace(msg,6) exit() end

-- This is used to distort the waveforms (see TIC function)
function distortWaves()
	local waveDistortRandom=math.random(0,1)*15
	for i=0,511 do
		poke4(0x1FFC8+i,peek4(0x1FFC8+i)~waveDistortRandom)
	end
end
--

GAME.numTeeth=math.max(GAME.numTeeth,2)  -- Lowest amount
GAME.numTeeth=math.min(GAME.numTeeth,13) -- Highest amount
GAME.numTeeth=math.floor(GAME.numTeeth)

-- This is how the bad tooth is randomly chosen!
toothNo=math.random(1,GAME.numTeeth)
--

centerW=112-4*GAME.numTeeth

function processGame(m)
	if m==0 then -- Title screen
		print("Press the spacebar or Enter to start!",1,84)
		print("Last time: "..(pmem(0)//60).." seconds",1,91)
		print("High score: "..pmem(1),1,98)
		print("2018-2019 StinkerB06",1,130)
		spr(14,207,103,-1,2,0,0,2,2)
		map(0,0,13,9,68,4,1)
		if keyp(48) or keyp(50) then
			sfx(2)
			FADE.mode,FADE.nextMode,FADE.nextMusic="OUT",1,nil
		end
		if key(64) and keyp(5) then -- Clear PMEM
			sfx(0)
			for pmClear=0,1 do pmem(pmClear,0) end
		end
	elseif m==1 then -- Gameplay
		for tooth=1,GAME.numTeeth do
			spr(Iif(Tstat[tooth],2,1),centerW+8*tooth,84)
			spr(3,centerW+8*tooth,92)
			if key(KEYcode[tooth]) and (not Tstat[tooth]) then
				sfx(5)
				Tstat[tooth]=true
				GAME.toothCount=GAME.toothCount+1
			end
		end
		-- Bad-tooth event code
		if key(KEYcode[toothNo]) then
			highScore=(GAME.toothCount>pmem(1))
			pmem(0,GAME.frame)
			if highScore then pmem(1,GAME.toothCount) end
			local newMusic=Iif(GAME.toothCount==GAME.numTeeth,0,2)
			FADE.mode,FADE.nextMode,FADE.nextMusic="OUT",2,{newMusic,0,0,false}
		end
		--
		print("Survival score: "..(GAME.toothCount),1,1)
		print("Time: "..(GAME.frame//60).." seconds",1,8)
		GAME.frame=GAME.frame+1
	elseif m==2 then -- Game over
		local win="You did it!"
		local death="You got bit by the crocodile's mouth!"
		print(Iif(GAME.toothCount==GAME.numTeeth,win,death),1,1)
		print("Press the spacebar or Enter to reset.",1,8)
		if highScore then 
			print("New high score!",1,20,math.random(11,15)) 
		end
		if keyp(48) or keyp(50) then
			sfx(2)
			FADE.mode,FADE.nextMode,FADE.nextMusic="OUT",3,nil
		end
	elseif m==3 then reset()
	else exception("ERR: invalid state of GAME.mode") end
end
function TIC()
	if (BGc&15)==15 then 
		exception("Color "..BGc.." isn't supported.") return
	end
	processFades()
	if FADE.mode=="OUT" then return end
	cls(BGc)
	poke(0x3FF8,BGc)
	processGame(GAME.mode)
	
	-- For cheating! (remove the dash marks at the beginning)
	
	--print(toothNo,228,1)
	--distortWaves()
end
-- <TILES>
-- 000:1111111111111111111111111111111111111111111111111111111111111111
-- 001:6666666666ffff666ffffff66ffffff66ffffff66ffffff66ffffff66ffffff6
-- 002:6666666666666666666666666666666666ffff666ffffff66ffffff66ffffff6
-- 003:6666666655555555555555555555555555555555555555555555555555555555
-- 004:5555555555555555555555555555555555555555555555555555555555555555
-- 005:5555555555555555555555555555555555555555555555555555555511111111
-- 006:1111111155555555555555555555555555555555555555555555555555555555
-- 007:6666666666666666666666666666666666666666666666666666666666666666
-- 008:55555fff555fffff55ffffff5fffffff5fffffffffffffffffffffffffffffff
-- 009:fff55555fffff555ffffff55fffffff5fffffff5ffffffffffffffffff00ffff
-- 010:55555fff555fffff55ffffff5fffffff5fffffffffffffffffffffffffff00ff
-- 011:fff55555fffff555ffffff55fffffff5fffffff5ffffffffffffffffffffffff
-- 014:fffffffccaacfffcca77cccccca77cccffc777ccfaaa7acca733affffa7afffc
-- 015:cccca777cccc7377ccca3777cca73777ca737aa7a7777a77caa77333caaa7377
-- 016:1555555515555555115555551111555511111155111111111111111111111111
-- 017:5555555555555555555555555555555555555555155555551111155511111111
-- 018:5555555555555555555555555555555555555555555555515551111111111111
-- 019:5555555155555551555555115555111155111111111111111111111111111111
-- 020:1111111111111111111111111111115511115555115555551555555515555555
-- 021:1111111111111555155555555555555555555555555555555555555555555555
-- 022:1111111155511111555555515555555555555555555555555555555555555555
-- 023:1111111111111111111111115511111155551111555555115555555155555551
-- 024:ffffffffffffffffffffffff5fffffff5fffffff55ffffff5555ffff55555555
-- 025:f0000fff000000ff000000fff0000ff5ff00fff5ffffff55ffff555555555555
-- 026:fff0000fff000000ff0000005ff0000f5fff00ff55ffffff5555ffff55555555
-- 027:fffffffffffffffffffffffffffffff5fffffff5ffffff55ffff555555555555
-- 030:fccccaaaffcccaaaccccccaaacccccaa7cccccaaaacccccacacccccaccacccca
-- 031:777aaaaaaaaaaacaaaaaaaa7aaaaaaa7aaaaaa77aaaaaa77aaaaaa7aaaaaaa7a
-- 032:1111111111ffff111ff11ff11ff111111ff111111ff11ff111ffff1111111111
-- 033:111111111fffff111ff11ff11ff11ff11ffff1111ff11ff11ff11ff111111111
-- 034:1111111111ffff111ff11ff11ff11ff11ff11ff11ff11ff111ffff1111111111
-- 035:1111111111666611166116611661111116611111166116611166661111111111
-- 036:1111111116666611166116611661166116666111166116611661166111111111
-- 037:1111111111666611166116611661166116666661166116611661166111111111
-- 038:1111111116666661111116611111661111661111166111111666666111111111
-- 039:1111111116666661166111111666611116611111166111111666666111111111
-- 040:11155111115f551111555511115555111115511111111111111f511111155111
-- </TILES>

-- <MAP>
-- 000:000212220222003242526272820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:415160606060606060606061710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:404080904040404040a0b040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:404081914040404040a1b140400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:707070707070707070707070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:011150505050505050505021310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- 003:731da516b529ec876655432100000000
-- 004:808807077770888809090990aaaa9642
-- 005:68abceb753211357acb6210000000000
-- </WAVES>

-- <SFX>
-- 000:039003a003b003c003c003c003c003c003b003a003a0039003900370035003400330032003100310033003400350036003700370036003500330f310104000000000
-- 001:63015300430f430d530e630073018303930393038303730203010300030f030e030003000300030003000300030003000300030003000300030003004000000c0000
-- 002:5406440304023401340f240d240c240c140b140b140b040a240a24090409240934090409440a540a640a740a840b940ba40bb40bc40be40be40bf40c200000000000
-- 003:05c005c005c005c015c01500250025003500350035003500450045004500450045004500550055006500650075007500750075007500850085008500200000000600
-- 004:4f078f00bf00ff000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f00f0b000310001
-- 005:0f07310f510d7f0b9f09af0bbf0adf09ff080f0b0f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f00b00011810041
-- 006:0f073f0daf09df0bff09af0bbf0adf09ff080f0b0f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f00d00000410041
-- </SFX>

-- <PATTERNS>
-- 000:400018000000800018600018000000900018800018000000b00018900018000000f00018d0001800000060001a40001a000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:b00016000000f00016d00016000000400018f00016000000600018400018000000900018800018000000d00018b00018000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:400034000000000000400032000000000000100000000000000000000000000000000000b00032e00032000000000000400034000000000000400032000000000000100000000000000000000000000000000000e00032500034000000000000700034000000000000700032000000000000100000000000000000000000000000000000e00032500034000000000000700034000000000000700032000000000000100000000000000000000000000000000000460022b60024860026f60026
-- 003:b50056000000000000b5005645006a000000000000b50056b50056000000b5005600000045006a000000000000b50056b50056000000000000b5005645006a000000000000b50056b50056000000b5005600000045006a000000000000b50056b50056000000000000b5005645006a000000000000b50056b50056000000b5005600000045006a000000000000b50056b50056000000000000b5005645006a000000000000b50056b50056000000b5005600000045006a000000000000b50056
-- 004:f7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004ef7004efb004e
-- 005:f60008960008d60008860008b60008660008960008460008860008f60006660008d60006460008b60006f60006960006d60006660006b60006460006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:040200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004200
-- 001:0c0441000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060
-- 002:0810000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf
-- </TRACKS>

-- <PALETTE>
-- 000:140c1c44243430346d4e4a4e854c30346524d04648757161597dced27d2c8595a16daa2cd2aa996dc2cadad45edeeed6
-- </PALETTE>

-- <COVER>
-- 000:0c9000007494648393160f00880077000012ffb0e45445353414055423e2033010000000129f40402000ff00c2000000000f00880078444243435642edee6d0d648441c0c12daa9958591a571716e4a4e400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080ff001080c1840b0a1c388031a2c58c0b1a3c780132a4c9841b2a5cb88133a6cd8c1b3a7cf80234a8c1942b4a9c398235aac59c2b5ab4791020cbc9943b0a08b920602ecb940776f4c9f397e2c104470c0c2a449022d3a84d82086ae4104001013b6a5579243b6e400a550675eab5fb22c4af4d929d3b663a2351846b06ccaa753e6a41af3db68dbb67d0a8d38d67d6956b96b06bd5a40fdac49b88b42d5d904917e50ba71f62ceb08bf245fb89dde1e4cc934e7dfc2914f3e1b18ffa964b08d025eecca517368c0b1ce26f9c87139e1c5a157952c7957e6e6d0c38f558b2cb8b1f3e8c39b2f5eccb9b3f7e0d3ab4f9e4dbab5fbe8d3bb6fdecdbbb7ffe0e5ab1ffe1f4ebcb9f3f8e3dba72f1ef8faf7f0f3ebcf4fdeb3fcfbf8f3ffbfaf3c5fbffff00ef6cfda41061860ed73021870e28c02d7902a4d064821eb5f0e949fde473d480f168451e7516947f178b39688e98883128f1e843f998322984e1b872ac792aa81f1c8d2ab8139d8132c733a842f9e8912e893209236f8025d804609e2629a4ea764e19b123924239d1ee7f4a7484a984001073298b3d69036c77526915a88b5289d4a6883d99c5a9826e89c1569812b986e49200d9d6278f62c9a19c9f52d996e48731e9e62f8c76f9e7ea97660aa6ed9b8a8854e1a81df8a56e924e09e82b819a4a61da863e5af69e83f17a396880928a3e51a3a29ad92aaeaee9cae4ff405dca4b6da6beda8b6eaabaea1b654bbefa0c60b2ca0bdb2543ce1b8c62b1c61b2ba2bece3b0daa5cca341d65b6d20b3d6447de6bcd2da9d244dd68b1ee7bf098b6ee5b4e25b7eeabfc6abd0115b31251f6153f2cb839cb7f2db9fadb731ebdfaebff2fb208fb3030c50b0cba9bbaa17820ffbc0f00f074c8163c50b4c3fa5c9f26cdfa2c3496c51f4c0138ce135c4278c71b8c82f9c1f27ca099c917acf2bac13fcce03cc53bcc733dc303bc39d8ce27ec04f7c83b0da379ce333cc3f8574bdc4470d6433df4f0d4272dc7d2d25ffcd476d1571d85f6db135d281bb2632b06b66fae9de069d201adc6f97a6f04d67cd3edbdb6bcd673dd259dd273eda7feffd477fd173ed9730efaa0e3831e8aa1e7832e83a2e0733e42a3e6014e11a4ea015e10a5e0116eb9a6ee9f7e0a78e2af8e4a79e6af9e8a7aeaaf7e4b574479d6721cee1168809ced09dec01ee70dbeb5184959c6dbfb64b5be67105dafb6145e47c7363cb65cb3f44c7d65c7fee85d67713fec35f3df5fbbb1fdc34f8db7f22dfe4eb2f6e70f6b3fee51466b90f16175979bfcefbf87dfe571cf6fb5ff89463f3c6ad7c69fb2eddf0e7df320aafc338db0a8d4e97199aed9f2122e3cf5cf818bf330a9fa674fbffd86cf73a19f160d18dd3ef5df4b7ab37d15fad79db9e160f2861cffd7f0d79249d8a05588bb406801c7be310ac0363124d162f4180c3e1a00ffb48ad122eaee88ed132e007185db580ce09732152a2c058924ad52fe48ac39e9013083347f93f66814c0328d663314c2e70bc883ca1e315d70e34fdaf8c7564ab191108b791024f428e1401646e18e3c2fdb1b3825466951d724c382e013b895cd1ea1d58e54df922fd714c8e12172949c4a9f1b18ea1c4a51b297f3216c071813c0f1c0738b3c622727b7ceb906e05b85acb4e505d8b4c35270bd883420282b5991402a01938bbca4e525596b403e7f84963474a12569b2446e6429450866a33f9960030c106a94d456ec5084fccc66102a94dca6a53f42dcc86643b99c12d6e337a980040473fb90ecd6a839c981237a331d9ae4f62b39421e4962535e9affdc866a3bb93dcb76942f9dd4e7663df95fc57a047420d4d7e43d0acdc30cf310ab0568a3332af05e764472aa0da8afe072dc408e10af9afc98a835f9e1540ed424a005292d37a972d086a4f32739396447c97157820413a708992d4500635d72e490a22d300f4d7ae19d86a31101dc27ab397ab4d5a225b32a4d476353e9f45d96453d9355e84d458a6007a6e336a21d486f4bbaa19fa2c43ca85d1ba83f5a6f44be5465a6ec0aa8438a7259b6648ea4252b6731fa2e4db264672d750c2e53f928d9b284f0a6850c22631b51138ab5b1b4658c64652b495cbac4d2b2191a6d533b63ddc276122e9d2c28615a3ad884645e97ad3a6a6122badfce96b3afad68a8c9412a0a558e2fcd8e34742e2959f34a367f022bb50e6b7e6ba1dcd6c5bf7d6ca0e073d8f99b52a2d89094156501ab51ac72e633bb65d2a1f009cdb74622f97c84ed610fc732c9568f0f77ccfe86739bcd53aa106386fb8ee21bebe2ce1a07d59fb5012f79f3d056da273a93d5be692da71ed162821b8facc56b09ebd8ced6b720c2b5ac677b6bf2908000b3
-- </COVER>

